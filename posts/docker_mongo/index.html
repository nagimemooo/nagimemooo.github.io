<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.69.0" />

  <title>[ docker ]啟動 mongo DB 與簡單操作 &middot; nagimemooo</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="[ docker ]啟動 mongo DB 與簡單操作">
<meta itemprop="description" content="本章介紹

使用docker-compose快速啟動mongodb
簡單的工具操作與MongoDB Shell 更新資料
">
<meta itemprop="datePublished" content="2020-05-01T10:30:25&#43;08:00" />
<meta itemprop="dateModified" content="2020-05-01T10:30:25&#43;08:00" />
<meta itemprop="wordCount" content="171">
<meta itemprop="image" content="https://nagimemooo.github.io/images/profile.png"/>



<meta itemprop="keywords" content="mongo,docker," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://nagimemooo.github.io/images/profile.png"/>

<meta name="twitter:title" content="[ docker ]啟動 mongo DB 與簡單操作"/>
<meta name="twitter:description" content="本章介紹

使用docker-compose快速啟動mongodb
簡單的工具操作與MongoDB Shell 更新資料
"/>


<meta property="og:title" content="[ docker ]啟動 mongo DB 與簡單操作" />
<meta property="og:description" content="本章介紹

使用docker-compose快速啟動mongodb
簡單的工具操作與MongoDB Shell 更新資料
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nagimemooo.github.io/posts/docker_mongo/" />
<meta property="og:image" content="https://nagimemooo.github.io/images/profile.png"/>
<meta property="article:published_time" content="2020-05-01T10:30:25+08:00" />
<meta property="article:modified_time" content="2020-05-01T10:30:25+08:00" /><meta property="og:site_name" content="Soho Theme" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="/images/profile.png" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>nagimemooo</h1>

      
      <p class="lead">Example Blog</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://nagimemooo.github.io">Home</a>
        </li>
        <li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/contact/">Contact</a>
        </li><li>
          <a href="/posts/">Posts</a>
        </li><li>
          <a href="/categories/">Categories</a>
        </li><li>
          <a href="/tags/">Tags</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="#" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/alexandrevicenzi/soho" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="#" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>[ docker ]啟動 mongo DB 與簡單操作</h1>

  <div class="post-date">
    <time datetime="2020-05-01T10:30:25&#43;0800">May 1, 2020</time> &middot; 1 min read
  </div>

  <p>本章介紹</p>
<ul>
<li>使用docker-compose快速啟動mongodb</li>
<li>簡單的工具操作與MongoDB Shell 更新資料</li>
</ul>
<blockquote>
<p>MongoDB是NoSQL的資料庫，以文件儲存資料，一般資料庫開Table須定義欄位(大小、型別、名稱等)，但是Collection完全不事先定義欄位，每筆document可以有不等數量的欄位。。</p>
</blockquote>
<p>名詞對應：</p>
<table>
<thead>
<tr>
<th>MongoDB</th>
<th>RDBMS</th>
<th>意思</th>
</tr>
</thead>
<tbody>
<tr>
<td>db</td>
<td>DB</td>
<td>資料庫</td>
</tr>
<tr>
<td>collection</td>
<td>Table</td>
<td>表格</td>
</tr>
<tr>
<td>document</td>
<td>record</td>
<td>一筆紀錄</td>
</tr>
</tbody>
</table>
<h1 id="1啟動mongo-docker">1.啟動mongo docker</h1>
<p>這邊直接用編輯docker-compose.yml  貼上網路找到的內容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">version</span>: <span style="color:#e6db74">&#39;3.1&#39;</span>

<span style="color:#66d9ef">services</span>:

  <span style="color:#66d9ef">mongo</span>:
    <span style="color:#66d9ef">image</span>: mongo
    <span style="color:#66d9ef">ports</span>:
      - <span style="color:#e6db74">&#34;27017:27017&#34;</span>
    <span style="color:#66d9ef">restart</span>: always
    <span style="color:#66d9ef">environment</span>:
      <span style="color:#66d9ef">MONGO_INITDB_ROOT_USERNAME</span>: root
      <span style="color:#66d9ef">MONGO_INITDB_ROOT_PASSWORD</span>: example
</code></pre></div><p>啟動</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">➜  mongo git:<span style="color:#f92672">(</span>master<span style="color:#f92672">)</span> ✗ docker-compose up -d   
Creating network <span style="color:#e6db74">&#34;mongo_default&#34;</span> with the default driver
Creating mongo_mongo_1         ... <span style="color:#66d9ef">done</span>
</code></pre></div><h1 id="2操作資料內容">2.操作資料內容</h1>
<p>以下可用透過一些網上mongo工具 ex Robo3T操作</p>
<p>先進行連線進入介面host: localhost, port: 27017</p>
<p>CreateDB&quot;test&rdquo;，新增一筆Collection&quot;user&rdquo;，與新增Documanet如下(Json格式)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;profile&#34;</span> : {
        <span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;user1&#34;</span>,
        <span style="color:#f92672">&#34;gender&#34;</span> : <span style="color:#e6db74">&#34;F&#34;</span>,
        <span style="color:#f92672">&#34;age&#34;</span> : <span style="color:#ae81ff">18</span>
    }
}
</code></pre></div><p>新增完會自動產生唯一的objectID，透過工具也可以對資料做簡單的修改動作。</p>
<h1 id="3mongo-shell">3.mongo shell</h1>
<ul>
<li>可以再有提供shell指令視窗的工具上下指令去做更新進階的搜尋，</li>
<li>例如mongo 3T上方就有視窗可以使用．</li>
</ul>
<h2 id="搜尋指令">搜尋指令</h2>
<h4 id="搜尋全部">搜尋全部</h4>
<p>db.getCollection(&lsquo;user&rsquo;).find({})</p>
<h4 id="搜尋by_id">搜尋by_id</h4>
<p>db.getCollection(&lsquo;user&rsquo;).find({_id:ObjectId(&ldquo;5eaa780f3dfac43981e4412c&rdquo;)})</p>
<h4 id="搜尋內容值">搜尋內容值</h4>
<p>db.getCollection(&lsquo;user&rsquo;).find({&ldquo;profile.name&rdquo;:&ldquo;user1&rdquo;})</p>
<h4 id="搜尋範圍-數字型態">搜尋範圍 數字型態</h4>
<p>[gt大於，gte大於等於，lt小於，lte小於等於]
db.getCollection(&lsquo;user&rsquo;).find({&ldquo;profile.gender&rdquo;:&ldquo;F&rdquo;,&ldquo;profile.age&rdquo;:{$gt:2,$lte:18}})</p>
<h4 id="搜尋範圍-字串型態">搜尋範圍 字串型態</h4>
<p>按UTF-8進行字典排序 表搜尋字母A~Z間
db.getCollection(&lsquo;user&rsquo;).find({&ldquo;profile.name&rdquo;:{$gt:&ldquo;a&rdquo;,$lte:&ldquo;z&rdquo;}})</p>
<h2 id="計算總數">計算總數</h2>
<p>db.getCollection(&lsquo;user&rsquo;).find().count()</p>
<h2 id="排序">排序</h2>
<p>依命名排序，其中 1 为升序排列，而 -1 是用于降序排列
db.getCollection(&lsquo;user&rsquo;).find({}).sort({name:1})</p>
<h3 id="顯示筆數limit與開始skip">顯示筆數(limit)與開始(skip)</h3>
<p>可以用他來做分頁讀取
db.getCollection(&lsquo;user&rsquo;).find({}).sort({name:1}).skip(0).limit(2)</p>
<h2 id="批次更新">批次更新</h2>
<p>一般來說工具就可以做內容更新，但如果需要透過指令，</p>
<h4 id="更新欄位">更新欄位</h4>
<p>將性別欄位“F”全改成“woman”</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.find<span style="color:#f92672">()</span>.forEach<span style="color:#f92672">(</span> <span style="color:#66d9ef">function</span><span style="color:#f92672">(</span>d<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
     
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>d.profile.gender<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;F&#34;</span><span style="color:#f92672">){</span>
    d.profile.gender<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;woman&#34;</span>
    db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.update<span style="color:#f92672">({</span><span style="color:#e6db74">&#34;profile.name&#34;</span>:d.profile.name<span style="color:#f92672">}</span>,d<span style="color:#f92672">)</span>;
    print<span style="color:#f92672">(</span>d.profile.name+<span style="color:#e6db74">&#34; process change done&#34;</span> <span style="color:#f92672">)</span>;  
<span style="color:#f92672">}</span>;
<span style="color:#f92672">})</span>;
</code></pre></div><h4 id="新增欄位合併內容">新增欄位合併內容</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.find<span style="color:#f92672">()</span>.forEach<span style="color:#f92672">(</span> <span style="color:#66d9ef">function</span><span style="color:#f92672">(</span>d<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
d.description<span style="color:#f92672">=</span> d.profile.name+<span style="color:#e6db74">&#34;,&#34;</span>+d.profile.gender;
db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.update<span style="color:#f92672">({</span><span style="color:#e6db74">&#34;profile.name&#34;</span>:d.profile.name<span style="color:#f92672">}</span>,d<span style="color:#f92672">)</span>;
    print<span style="color:#f92672">(</span>d.profile.name+<span style="color:#e6db74">&#34; process change done&#34;</span> <span style="color:#f92672">)</span>;  
<span style="color:#f92672">})</span>;
</code></pre></div><h2 id="刪除欄位">刪除欄位</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.find<span style="color:#f92672">()</span>.forEach<span style="color:#f92672">(</span> <span style="color:#66d9ef">function</span><span style="color:#f92672">(</span>d<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
delete d.description
db.getCollection<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">)</span>.update<span style="color:#f92672">({</span><span style="color:#e6db74">&#34;profile.name&#34;</span>:d.profile.name<span style="color:#f92672">}</span>,d<span style="color:#f92672">)</span>;
    print<span style="color:#f92672">(</span>d.profile.name+<span style="color:#e6db74">&#34; process change done&#34;</span> <span style="color:#f92672">)</span>;  
<span style="color:#f92672">})</span>;
</code></pre></div><ul>
<li>如果是要在mongo的docker環境上面下指令
需要把指令包成js，檔案丟進去docker裡面，
然後下指令</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">load<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;script/Change.js&#34;</span><span style="color:#f92672">)</span> //檔案位置
mongo 127.0.0.1:27017/test Change.js
</code></pre></div><p>執行結果與上述內容一樣</p>
<p>本章對mongo的簡單操作到此結束，
之後再介紹如何用golang程式去對mongo CRUD操作．</p>
</div>


  </main>

  <footer>
  <div>
    &copy; Author Name 2020

    &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

    &middot; Build with <a href="https://gohugo.io/" target="_blank">Hugo</a> & <a href="https://themes.gohugo.io/soho/" target="_blank">Soho</a> theme
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
